{% extends 'base.html' %}

{% block title %}Manage FAQs{% endblock %}

{% block body_content %}
    <h2>Manage FAQs</h2>

    <div class="form-section">
        <h3>Add New FAQ</h3>
        <form method="POST" action="{{ url_for('admin_routes.manage_faqs') }}">
            <input type="hidden" name="action" value="add">
            <label for="question">Question:</label>
            <textarea id="question" name="question" rows="3" required></textarea>

            <label for="answer">Answer:</label>
            <textarea id="answer" name="answer" rows="5" required></textarea>

            <button type="submit">Add FAQ</button>
        </form>
    </div>

    <div class="table-section">
        <h3>Existing FAQs</h3>
        {% if faqs %}
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Question</th>
                        <th>Answer</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for faq in faqs %}
                    <tr>
                        <td>{{ faq.id }}</td>
                        <td>{{ faq.question }}</td>
                        <td>{{ faq.answer }}</td>
                        <td>
                            <button class="edit-button"
                                data-faq-id="{{ faq.id }}"
                                data-faq-question="{{ faq.question }}"
                                data-faq-answer="{{ faq.answer }}">
                                Edit
                            </button>
                            <form method="POST" action="{{ url_for('admin_routes.manage_faqs') }}" style="display:inline;">
                                <input type="hidden" name="action" value="delete">
                                <input type="hidden" name="faq_id" value="{{ faq.id }}">
                                <button type="submit" onclick="return confirm('Are you sure you want to delete this FAQ?');">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No FAQs configured yet.</p>
        {% endif %}
    </div>

    <div id="editFaqModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3>Edit FAQ</h3>
            <form id="editFaqForm" method="POST" action="{{ url_for('admin_routes.manage_faqs') }}">
                <input type="hidden" name="action" value="update">
                <input type="hidden" id="edit_faq_id" name="faq_id">

                <label for="edit_question">Question:</label>
                <textarea id="edit_question" name="question" rows="3" required></textarea>

                <label for="edit_answer">Answer:</label>
                <textarea id="edit_answer" name="answer" rows="5" required></textarea>

                <button type="submit">Update FAQ</button>
            </form>
        </div>
    </div>

    <script>
        // JavaScript for modal functionality
        const editButtons = document.querySelectorAll('.edit-button');
        const modal = document.getElementById('editFaqModal');
        const closeButton = document.querySelector('.close-button');
        const editFaqForm = document.getElementById('editFaqForm');

        editButtons.forEach(button => {
            button.addEventListener('click', () => {
                const faqId = button.dataset.faqId;
                const faqQuestion = button.dataset.faqQuestion;
                const faqAnswer = button.dataset.faqAnswer;

                document.getElementById('edit_faq_id').value = faqId;
                document.getElementById('edit_question').value = faqQuestion;
                document.getElementById('edit_answer').value = faqAnswer;

                modal.style.display = 'block';
            });
        });

        closeButton.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });
    </script>
{% endblock %}